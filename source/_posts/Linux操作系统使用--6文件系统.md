---
title: Linux操作系统使用--6文件系统
date: 2017-10-29 09:21:15
categories: 嵌入式
tags: [嵌入式,学习笔记,文件系统,根文件系统,虚拟文件系统]
comments: true

---
> 本篇文章主要围绕linux文件系统总结相关知识点，包括文件系统类型、分区与挂载等基本概念以及文件系统重要目录分析。最后简要叙述文件系统体系结构中起重要作用的虚拟文件系统概念，以作后期扩展学习。<!-- more -->

# 文件系统简介
## 文件系统概念
- 文件系统是一种管理和访问磁盘的软件机制。用于组织和管理计算机存储设备上的大量文件，并提供用户交互接口。
- 文件系统是linux操作系统的重要组成部分。在linux操作系统中，“一切皆文件”。因此硬件设备也是一种特殊的文件，它挂载在某一目录下被使用。我们需掌握体会linux文件系统与windows文件系统的不同之处。

## 文件系统类型
常见的linux文件系统有以下几种：

1. 磁盘文件类型
本地主机可以访问的文件系统，包括硬盘、CD-ROM、DVD、USB、磁盘阵列等。文件系统格式有：Ext3、Ext4、vfat、FAT32、FAT16、NTFS等。
2. 网络文件系统
远程可访问的文件系统，在服务器端仍然是本地的磁盘文件系统。文件格式有：NFS、Samba、AFP、WebDAV等。
3. 专有/虚拟文件系统
不驻留磁盘的文件系统，即为操作系统加载才产生。文件格式有：TMPFS（临时文件系统）、PROCFS（进程文件系统）、LOOPBACKFS（回送文件系统）。 

*注：*
*1. 使用du -aTh命令可以看到各文件系统的使用情况和类型。*
*2. 对比Windows系统，文件系统格式主要为NTFS、FAT16、FAT32。*

## 分区与挂载
**分区**

- 硬盘分区是针对硬件进行操作，分为主分区、扩展分区、逻辑分区。
- 交换分区：将内存中的内容写入磁盘或者从磁盘中读出，称为内存交换。交换分区的大小最小为计算机内存。需要把交换分区放在硬盘驱动器的起始位置。

**挂载**

- 挂载是指将分区和目录对应的过程。将一个文件系统和一个存储设备关联起来。挂载点是指文件树中的挂载目录。

**linux下分区与目录的关系**

- Linux每一个分区都和某一个目录对应，对目录的操作就是对分区的操作，从而实现了硬件管理手段和软件目录管理手段的统一。
- 在Linux下，查找某个文件，不需要知道其物理存储位置，只需要知道属于哪一个目录即可。
- 在Windows下，目录属于分区，而在Linux下，分区属于目录。
- Linux文件系统和Windows文件系统区别如下图所示。

![ ](http://osjn6k0nm.bkt.clouddn.com/linux%E5%92%8Cwindows%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%AF%94%E8%BE%83.jpg "Linux文件系统和Windows文件系统区别")

*注:*
*1. 分区的概念可以结合安装linux操作系统的操作进一步加深理解。*
*2. 参考文档：[《嵌入式操作系统(Linux篇)》1.5.1][1]*

# 根文件系统目录结构
## 根文件系统
定义：存放运行、维护系统所必须的各种工具软件、库文件、脚本、配置文件和其他特殊文件的地方，也可以安装各种软件包，其实就是目录和文件。

## 文件类型
linux系统下文件不是以后缀名不同来区分不同的文件。linux操作系统下有7种文件类型。

- b 块设备文件
- c 字符设备文件
- d 目录文件
- \- 普通文件
- l 链接文件
- s 套结字文件
- p 管道文件

**说明**

1. 用ls -l命令可以看到前10个字符表示文件类型和访问权限。访问权限包括读r、写w、执行x。访问权限又分为3个不同用户级别：文件所有者、文件从属组、其他用户。
2. 使用chmod可使用符号标记或者八进制数两种方式改变文件访问权限。如chmod u+r xxx或者chmod 777 xxx。使用符号标记方式改变，可指定多个用户级别，用逗号隔开。

## 目录分析
Linux文件系统就是一个树形的分层组织结构，类似于一棵倒置的树。将根（/）作为文件系统的唯一起点，其他文件和外部设备都以文件的形式挂载在这个文件树上。每一个linux操作系统的文件系统不完全一样，这里以Ubuntu为例，只介绍重要的几个目录。

- /bin 普通用户可以使用的命令存放地，类似的有/usr/bin、/usr/local/bin。
- /sbin 超级用户可以使用的命令存放地，类似的有/usr/sbin、/usr/local/sbin。
- /dev 存放所有设备文件，包括硬盘、键盘、鼠标、网卡、终端等。
- /etc 存放系统配置文件。
- /home 普通用户家目录。
- /root 超级用户家目录。
- /lib 存放共享库文件，包括被/bin、/sbin程序使用的库文件，类似的有/usr/lib、/usr/local/lib。
- /media Ubuntu系统自动挂载CD-ROM、USB等，存放临时读入的文件。
- /mnt 作为临时被挂载文件系统的挂载点。
- /opt 作为可选文件和程序的存放目录，通常第三方软件和通过源码安装的软件，可安装于该目录。
- /proc 存放所有标志为文件的进程，每一个进程在proc下有一个名为其进程号的目录。
- /tmp 存放临时文件。
- /lost\+found 恢复文件存放位置，系统崩溃时，可在该目录下找到恢复文件，通常为空。
- /usr/include c/c++等开发环境的标准include文件。
- /usr/local 安装本地程序的一般默认路径。
- /var/cache 应用程序缓存目录。

**说明**

1. 使用tree命令可以查看系统的文件树形目录结构。
2. 用于intel NUC3815的开发IDE Intel® System Studio IoT Edition和openwrt的交叉编译环境都安装在opt下。
3. /tmp文件夹是tmpfs类型的文件系统挂载于此，而tmpfs文件系统由内核支持，存在于**内存**中，由于内存的数据掉电丢失，因此系统重启后，该目录下的文件被清空。openwrt系统下安装软件，通常将软件包放于此目录。
4. 制作根文件系统的方法详见系统移植部分。

*参考文档：[Linux文件系统以及目录结构简介][2]*

# 文件系统体系结构
[linux文件系统组件的体系结构][3]如下图所示，该图显示了用户空间和内核空间中与文件系统相关的主要组件之间的关系。

![ ](https://www.ibm.com/developerworks/cn/linux/l-linux-filesystem/figure1.gif  "linux文件系统组件的体系结构")

文件系统包括三个部分：虚拟文件系统、cache、真正的文件系统(vfat、Ext3等)。其中有重要作用的是**虚拟文件系统(VFS)**。它是一种转换机制，仅存在于内存中，不存在外存空间。它的作用如下：

1. 给用户空间的程序提供文件系统接口，通过一套统一的文件IO系统调用，对任意文件操作。
2. 提供抽象功能，通过一些数据结构及其方法向实际的文件系统提供接口，实现不同文件系统在Linux中共存。

*注：*
*1. 从调用open、read等函数到设备文件正确返回数据的过程加深理解文件系统体系结构。*
*2. 后期可深入内核中文件系统源代码加深理解文件系统的工作机制。*
*3. 参考文档：[Linux 文件系统剖析][3]*

[1]:  http://www.ryjiaoyu.com/book/details/4461
[2]: http://blog.csdn.net/guodongsoft/article/details/52523979
[3]: https://www.ibm.com/developerworks/cn/linux/l-linux-filesystem/